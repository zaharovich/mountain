<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Locator - –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .test-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        h1 {
            color: #1a1a1a;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            color: #2563eb;
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            border-left: 3px solid #2563eb;
        }
        
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 5px 5px 0;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .output {
            background: #1a1a1a;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.success {
            background: #10b981;
            color: white;
        }
        
        .status.error {
            background: #ef4444;
            color: white;
        }
        
        .status.pending {
            background: #f59e0b;
            color: white;
        }
        
        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav a {
            background: white;
            color: #2563eb;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            border: 2px solid #2563eb;
            transition: all 0.3s;
        }
        
        .nav a:hover {
            background: #2563eb;
            color: white;
        }
        
        .nav a.active {
            background: #2563eb;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Store Locator - –¢–µ—Å—Ç–æ–≤–∞ –∫–æ–Ω—Å–æ–ª—å</h1>
        
        <div class="nav">
            <a href="index.html" class="nav-link">üè† –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø—Ä–æ–≥—Ä–∞–º–∏</a>
            <a href="#" onclick="clearOutput(); return false;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤–∏–≤—ñ–¥</a>
        </div>

        <!-- –®–ò–§–†–£–í–ê–ù–ù–Ø -->
        <div class="test-section">
            <h2>üîê –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è</h2>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 1:</strong> –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è/—Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
                <button onclick="runCryptoTest()">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç</button>
                <span id="cryptoStatus" class="status pending" style="display:none;"></span>
            </div>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 2:</strong> –ì–µ–Ω–µ—Ä—É—î–º–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π JSON –¥–ª—è 1–°
                <button onclick="generateEncrypted()">–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
            </div>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 3:</strong> –í–∞–ª—ñ–¥–∞—Ü—ñ—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö
                <button onclick="validateEncrypted()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
                <span id="validateStatus" class="status pending" style="display:none;"></span>
            </div>
        </div>

        <!-- –ì–ï–û–õ–û–ö–ê–¶–Ü–Ø -->
        <div class="test-section">
            <h2>üìç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó</h2>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 1:</strong> –û–±—á–∏—Å–ª–µ–Ω–Ω—è –≤—ñ–¥—Å—Ç–∞–Ω—ñ (Haversine)
                <button onclick="testDistance()">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 2:</strong> –ü–æ—à—É–∫ –º–∞–≥–∞–∑–∏–Ω—ñ–≤ –≤ —Ä–∞–¥—ñ—É—Å—ñ
                <button onclick="testRadiusSearch()">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 3:</strong> –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫ (3‚Üí6‚Üí10‚Üí20–∫–º)
                <button onclick="testAdaptiveRadius()">–¢–µ—Å—Ç</button>
            </div>
        </div>

        <!-- –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –î–ê–ù–ò–ú–ò -->
        <div class="test-section">
            <h2>üíæ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è DataManager</h2>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 1:</strong> –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∑ Google Maps URL
                <button onclick="testParseCoordinates()">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 2:</strong> –ï–∫—Å–ø–æ—Ä—Ç –¥–ª—è WordPress
                <button onclick="testWordPressExport()">–ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏</button>
            </div>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 3:</strong> –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö
                <button onclick="testDataValidation()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
                <span id="validationStatus" class="status pending" style="display:none;"></span>
            </div>
        </div>

        <!-- RATE LIMITER -->
        <div class="test-section">
            <h2>üõ°Ô∏è –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Rate Limiter</h2>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 1:</strong> –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ (3 –∑–∞–ø–∏—Ç—É –≤ —Ä–∞–¥—ñ—É—Å—ñ 1–∫–º)
                <button onclick="testRateLimiter()">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-item">
                <strong>–¢–µ—Å—Ç 2:</strong> –û—á–∏—Å—Ç–∏—Ç–∏ÂéÜ–∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø–∏—Ç—ñ–≤
                <button onclick="clearRateLimiterHistory()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
            </div>
        </div>

        <!-- –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø -->
        <div class="test-section">
            <h2>‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>
            <div class="test-item">
                <button onclick="showSystemInfo()">–ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É</button>
            </div>
        </div>

        <!-- –í–ò–í–Ü–î -->
        <div class="test-section">
            <h2>üìã –í–∏–≤—ñ–¥ —Ç–µ—Å—Ç—ñ–≤</h2>
            <div id="output" class="output">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç–µ—Å—Ç–∏...</div>
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç–∏ -->
    <script src="js/crypto.js"></script>
    <script src="js/test-data.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/geolocation.js"></script>

    <script>
        const output = document.getElementById('output');
        
        function log(...args) {
            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    return JSON.stringify(arg, null, 2);
                }
                return String(arg);
            }).join(' ');
            
            output.textContent += message + '\n\n';
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            output.textContent = '';
        }
        
        function setStatus(elementId, status, message) {
            const el = document.getElementById(elementId);
            if (el) {
                el.textContent = message;
                el.className = 'status ' + status;
                el.style.display = 'inline-block';
            }
        }

        // ====== –¢–ï–°–¢–ò ======
        
        function runCryptoTest() {
            clearOutput();
            log('üîê –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—É —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è...\n');
            
            try {
                const result = testDecryption();
                setStatus('cryptoStatus', result ? 'success' : 'error', 
                    result ? '‚úì –£–°–ü–Ü–•' : '‚úó –ü–û–ú–ò–õ–ö–ê');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞:', error);
                setStatus('cryptoStatus', 'error', '‚úó –ü–û–ú–ò–õ–ö–ê');
            }
        }
        
        function generateEncrypted() {
            clearOutput();
            log('üìù –ì–µ–Ω–µ—Ä—É—î–º–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π JSON...\n');
            
            try {
                const payload = generateTestEncryptedData();
                log('\n‚úì –£—Å–ø—ñ—à–Ω–æ –≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ!\n\n–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü–µ–π JSON –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ:');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞:', error);
            }
        }
        
        function validateEncrypted() {
            clearOutput();
            log('‚úì –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ...\n');
            
            try {
                const encrypted = encryptData(TEST_DATA);
                const isValid = isValidEncryptedData(encrypted);
                
                log('–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –≤–∞–ª—ñ–¥–Ω—ñ:', isValid);
                setStatus('validateStatus', isValid ? 'success' : 'error',
                    isValid ? '‚úì –í–ê–õ–Ü–î–ù–Ü' : '‚úó –ù–ï–í–ê–õ–Ü–î–ù–Ü');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞:', error);
                setStatus('validateStatus', 'error', '‚úó –ü–û–ú–ò–õ–ö–ê');
            }
        }
        
        function testDistance() {
            clearOutput();
            log('üìè –û–±—á–∏—Å–ª–µ–Ω–Ω—è –≤—ñ–¥—Å—Ç–∞–Ω—ñ...\n');
            
            const point1 = { lat: 50.0056, lng: 36.2345 };
            const point2 = { lat: 50.0105, lng: 36.2456 };
            
            const distance = GeoLocation.calculateDistance(
                point1.lat, point1.lng,
                point2.lat, point2.lng
            );
            
            log(`–¢–æ—á–∫–∞ 1: ${point1.lat}, ${point1.lng}`);
            log(`–¢–æ—á–∫–∞ 2: ${point2.lat}, ${point2.lng}`);
            log(`–í—ñ–¥—Å—Ç–∞–Ω—å: ${distance.toFixed(3)} –∫–º\n‚úì OK`);
        }
        
        function testRadiusSearch() {
            clearOutput();
            log('üîç –ü–æ—à—É–∫ –º–∞–≥–∞–∑–∏–Ω—ñ–≤ –≤ —Ä–∞–¥—ñ—É—Å—ñ...\n');
            
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –•–∞—Ä–∫—ñ–≤ —è–∫ —Ç–æ—á–∫—É
            const userLat = 50.0056;
            const userLng = 36.2345;
            
            const shops = TEST_DATA.shops.map(shop => ({
                ...shop,
                coords: dataManager.parseCoordinates(shop.map)
            }));
            
            const inRadius = GeoLocation.findShopsInRadius(shops, userLat, userLng, 1);
            log(`–ú–∞–≥–∞–∑–∏–Ω—ñ–≤ —É —Ä–∞–¥—ñ—É—Å—ñ 1–∫–º: ${inRadius.length}`);
            inRadius.forEach((shop, i) => {
                log(`${i + 1}. ${shop.name} (${shop.distance.toFixed(2)} –∫–º)`);
            });
        }
        
        function testAdaptiveRadius() {
            clearOutput();
            log('üéØ –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫...\n');
            
            const shops = TEST_DATA.shops.map(shop => ({
                ...shop,
                coords: dataManager.parseCoordinates(shop.map)
            }));
            
            const result = GeoLocation.findAdaptiveRadius(shops, 50.0056, 36.2345, 10);
            log(`–ó–Ω–∞–π–¥–µ–Ω–æ: ${result.shops.length} –º–∞–≥–∞–∑–∏–Ω—ñ–≤`);
            log(`–†–∞–¥—ñ—É—Å: ${result.radius} –∫–º`);
            log(`–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: ${result.message}`);
        }
        
        function testParseCoordinates() {
            clearOutput();
            log('üìç –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...\n');
            
            TEST_DATA.shops.forEach(shop => {
                const coords = dataManager.parseCoordinates(shop.map);
                log(`${shop.name}`);
                log(`  URL: ${shop.map}`);
                log(`  –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${coords.lat}, ${coords.lng}\n`);
            });
        }
        
        function testWordPressExport() {
            clearOutput();
            log('üìä –ï–∫—Å–ø–æ—Ä—Ç –¥–ª—è WordPress...\n');
            
            dataManager.data = TEST_DATA;
            const wpData = dataManager.exportForWordPress();
            
            log(JSON.stringify(wpData, null, 2));
        }
        
        function testDataValidation() {
            clearOutput();
            log('‚úì –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö...\n');
            
            try {
                const isValid = dataManager.validateDataStructure(TEST_DATA);
                log('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∞–ª—ñ–¥–Ω–∞:', isValid);
                setStatus('validationStatus', isValid ? 'success' : 'error',
                    isValid ? '‚úì –í–ê–õ–Ü–î–ù–ê' : '‚úó –ù–ï–í–ê–õ–Ü–î–ù–ê');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞:', error);
                setStatus('validationStatus', 'error', '‚úó –ü–û–ú–ò–õ–ö–ê');
            }
        }
        
        function testRateLimiter() {
            clearOutput();
            log('üõ°Ô∏è –¢–µ—Å—Ç Rate Limiter...\n');
            
            log('–°–∏–º—É–ª—é—î–º–æ 3 –∑–∞–ø–∏—Ç—É –∑ –æ–¥–Ω—ñ—î—ó IP –≤ —Ä–∞–¥—ñ—É—Å—ñ 1–∫–º:');
            
            // –û—á–∏—â–∞—î–º–æ –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º
            rateLimiter.clearHistory();
            
            setTimeout(() => {
                rateLimiter.checkAndRecord(50.0000, 36.2300).then(r1 => {
                    log(`–ó–∞–ø–∏—Ç 1: ${r1 ? '‚úì –î–û–ó–í–û–õ–ï–ù' : '‚úó –ó–ê–ë–õ–û–ö–ò–†–ê–ù'}`);
                    
                    rateLimiter.checkAndRecord(50.0001, 36.2301).then(r2 => {
                        log(`–ó–∞–ø–∏—Ç 2: ${r2 ? '‚úì –î–û–ó–í–û–õ–ï–ù' : '‚úó –ó–ê–ë–õ–û–ö–ò–†–ê–ù'}`);
                        
                        rateLimiter.checkAndRecord(50.0002, 36.2302).then(r3 => {
                            log(`–ó–∞–ø–∏—Ç 3: ${r3 ? '‚úì –î–û–ó–í–û–õ–ï–ù' : '‚úó –ó–ê–ë–õ–û–ö–ò–†–ê–ù'}`);
                            
                            rateLimiter.checkAndRecord(50.0003, 36.2303).then(r4 => {
                                log(`–ó–∞–ø–∏—Ç 4 (–º–∞—î –±—É—Ç–∏ –∑–∞–±–ª–æ–∫–∏—Ä–∞–Ω): ${r4 ? '‚úó –ü–û–ú–ò–õ–ö–ê - –î–û–ó–í–û–õ–ï–ù!' : '‚úì –ó–ê–ë–õ–û–ö–ò–†–ê–ù (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)'}`);
                            });
                        });
                    });
                });
            }, 100);
        }
        
        function clearRateLimiterHistory() {
            clearOutput();
            rateLimiter.clearHistory();
            log('‚úì –Ü—Å—Ç–æ—Ä—ñ—è Rate Limiter –æ—á–∏—â–µ–Ω–∞');
        }
        
        function showSystemInfo() {
            clearOutput();
            log('‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É\n');
            
            log('üåç –ë—Ä–∞—É–∑–µ—Ä:', navigator.userAgent.substring(0, 60) + '...');
            log('üì± –ú–æ–±—ñ–ª—å–Ω–∏–π:', /Mobile|Android/i.test(navigator.userAgent) ? '–¢–∞–∫' : '–ù—ñ');
            log('üîí HTTPS:', window.location.protocol === 'https:' ? '–¢–∞–∫' : '–ù—ñ');
            
            log('\nüì¶ –ú–æ–¥—É–ª—ñ:');
            log('  ‚úì Crypto API –¥–æ—Å—Ç—É–ø–Ω–∞');
            log('  ‚úì DataManager –∑–∞–≥—Ä—É–∂–µ–Ω–∏–π');
            log('  ‚úì GeoLocation –∑–∞–≥—Ä—É–∂–µ–Ω–∏–π');
            log('  ‚úì Test Data –∑–∞–≥—Ä—É–∂–µ–Ω—ñ');
            
            log('\nüíæ Storage:');
            log('  localStorage:', localStorage.getItem('store-locator-data-v1') ? '–Ñ –¥–∞–Ω—ñ' : '–ü—É—Å—Ç–æ');
            log('  Cache TTL: 24 –≥–æ–¥–∏–Ω–∏');
            
            log('\nüîë –ö–ª—é—á —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è: ' + ENCRYPTION_KEY.substring(0, 20) + '...');
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        log('‚úì –¢–µ—Å—Ç–æ–≤–∞ –∫–æ–Ω—Å–æ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞\n');
        log('–í–∏–±–µ—Ä—ñ—Ç—å —Ç–µ—Å—Ç –≤–∏—â–µ –¥–ª—è –∑–∞–ø—É—Å–∫—É...');
    </script>
</body>
</html>
